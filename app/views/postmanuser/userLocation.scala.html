@(postmanid:Int)<!DOCTYPE html><html>	<head>		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />		<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />		<style type="text/css">		body, html,#allmap {width: 100%;height: 100%;overflow: hidden;margin:0;font-family:"微软雅黑";}		</style>		<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=5LVr5CieSP2a11pR4sHAtWGU"></script>		<script src="@assets.CdnAssets.urlForAdminLTEPlugins("jQuery/jQuery-2.1.3.min.js")"></script>		<title>多个标注点沿折线的轨迹运动</title>	</head>	<body>		<div id="allmap"></div>	</body></html><script type="text/javascript">	// 百度地图API功能	var map = new BMap.Map("allmap");	var bounds = null;	var linesPoints = null;	function initMap() {		map.enableScrollWheelZoom();//启用滚轮放大缩小		map.addControl(new BMap.NavigationControl()); // 添加平移缩放控件		map.addControl(new BMap.ScaleControl()); // 添加比例尺控件		map.addControl(new BMap.OverviewMapControl()); //添加缩略地图控件	}	function addClickHandler(content,marker){		marker.addEventListener("click",function(e){			openInfo(content,e)}		);	}	function openInfo(content,e){		var p = e.target;		var point = new BMap.Point(p.getPosition().lng, p.getPosition().lat);		var infoWindow = new BMap.InfoWindow(content,opts);  // 创建信息窗口对象		map.openInfoWindow(infoWindow,point); //开启信息窗口	}	function loopData(dataDetail){		var detailTemp = dataDetail[0];		var detailTemp1 = dataDetail[1];		if(detailTemp[0]!=detailTemp1[0] ||  detailTemp[1]!=detailTemp1[1]){			var spoi = new BMap.Point(detailTemp[0],detailTemp[1]);    // 起点1			var epoi  = new BMap.Point(detailTemp1[0],detailTemp1[1]);    // 终点			bounds = new Array();			linesPoints = new Array();			var driving3 = new BMap.DrivingRoute(map,{onSearchComplete:drawLine});  // 驾车实例,并设置回调			driving3.search(spoi, epoi);                                       // 搜索一条线路		}		dataDetail.splice(0,1);		if(dataDetail.length>1){			loopData(dataDetail)		}	}	function drawLine(results){		var opacity = 0.45;		var planObj = results.getPlan(0);		var b = new Array();		var addMarkerFun = function(point,imgType,index,title){			var url;			var width;			var height			var myIcon;			// imgType:1的场合，为起点和终点的图；2的场合为车的图形			if(imgType == 1){				url = "http://developer.baidu.com/map/jsdemo/img/dest_markers.png";				width = 42;				height = 34;				myIcon = new BMap.Icon(url,new BMap.Size(width, height),{offset: new BMap.Size(14, 32),imageOffset: new BMap.Size(0, 0 - index * height)});			}else{				url = "http://developer.baidu.com/map/jsdemo/img/trans_icons.png";				width = 22;				height = 25;				var d = 25;				var cha = 0;				var jia = 0				if(index == 2){					d = 21;					cha = 5;					jia = 1;				}				myIcon = new BMap.Icon(url,new BMap.Size(width, d),{offset: new BMap.Size(10, (11 + jia)),imageOffset: new BMap.Size(0, 0 - index * height - cha)});			}			var marker = new BMap.Marker(point, {icon: myIcon});			if(title != null && title != ""){				marker.setTitle(title);			}			// 起点和终点放在最上面			if(imgType == 1){				marker.setTop(true);			}			map.addOverlay(marker);		}		var addPoints = function(points){			for(var i = 0; i < points.length; i++){				bounds.push(points[i]);				b.push(points[i]);			}		}		// 绘制驾车步行线路		for (var i = 0; i < planObj.getNumRoutes(); i ++){			var route = planObj.getRoute(i);			if (route.getDistance(false) <= 0){continue;}			addPoints(route.getPath());			// 驾车线路			if(route.getRouteType() == BMAP_ROUTE_TYPE_DRIVING){				map.addOverlay(new BMap.Polyline(route.getPath(), {strokeColor: "#0030ff",strokeOpacity:opacity,strokeWeight:6,enableMassClear:true}));			}else{				// 步行线路有可能为0				map.addOverlay(new BMap.Polyline(route.getPath(), {strokeColor: "#30a208",strokeOpacity:0.75,strokeWeight:4,enableMassClear:true}));			}		}		map.setViewport(bounds);		// 终点		addMarkerFun(results.getEnd().point,1,1);		// 开始点		addMarkerFun(results.getStart().point,1,0);		linesPoints[linesPoints.length] = b;	}	function initLine(){		bounds = new Array();		linesPoints = new Array();		map.clearOverlays();                                                    // 清空覆盖物		var driving3 = new BMap.DrivingRoute(map,{onSearchComplete:drawLine});  // 驾车实例,并设置回调		driving3.search(spoi1, epoi);                                       // 搜索一条线路		var driving4 = new BMap.DrivingRoute(map,{onSearchComplete:drawLine});  // 驾车实例,并设置回调		driving4.search(spoi2, epoi);                                       // 搜索一条线路	}	$.ajax({		type:"GET",		url:"/postmanuser/userLocationData/@postmanid",		datatype: "json",//"xml", "html", "script", "json", "jsonp", "text".		beforeSend:function(){},		success:function(data){			var dataDetail = data;			if(data!=null && data.length>1){				initMap();				map.centerAndZoom(new BMap.Point(data[0][0],data[0][1]), 18);// 初始化地图,设置中心点坐标和地图级别。				console.log(data.length+"===============");				console.log(dataDetail);				loopData(dataDetail);				for(var i=0;i<dataDetail.length;i++){					var marker = new BMap.Marker(new BMap.Point(dataDetail[i][0],dataDetail[i][1]));  // 创建标注					var content = dataDetail[i][2];					map.addOverlay(marker);               // 将标注添加到地图中					addClickHandler(content,marker);				}				var myIcon = new BMap.Icon("http://developer.baidu.com/map/jsdemo/img/Mario.png", new BMap.Size(32, 70), {imageOffset: new BMap.Size(0, 0)});				function run(){					var timeWait = 0;					runReset(0,linesPoints.length);					function runReset(m,pointLength){						if(m<pointLength){							var pts = linesPoints[m];							var len = pts.length;							setTimeout(function(){								console.log(m);								var carMk = new BMap.Marker(pts[0],{icon:myIcon});								map.addOverlay(carMk);								resetMkPoint(1,len,pts,carMk,m);								m++;								timeWait = (timeWait+ len);								runReset(m,pointLength);							},100*timeWait);						}					}					function resetMkPoint(i,len,pts,carMk,j){						carMk.setPosition(pts[i]);						if(i < len){							setTimeout(function(){								i++;								resetMkPoint(i,len,pts,carMk,j);							},100);						}					}				}				//	initLine();				setTimeout(function(){					run();				},1500);				var opts = {					width : 250,     // 信息窗口宽度					height: 80,     // 信息窗口高度					title : "信息窗口" , // 信息窗口标题					enableMessage:true//设置允许信息窗发送短息				};			}else{				return;			}		},		complete: function(XMLHttpRequest, textStatus){		},		error: function(){			$("#Loadding").hide();			alert("提示请检查一下网络!");		}	});</script>